<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.campingez.admin.model.dao.AdminDao">
  <select id="findAllUserList" resultMap="userMap">
  	select
    	u.*,
    	a.user_id auth_user_id,
    	a.auth
	from
    	ez_user u join authority a
       		on u.user_id = a.user_id
  </select>
  
  <select id="findAllBlackList" resultMap="userMap">
  	select
  		u.*,
  		a.user_id auth_user_id,
  		a.auth
  	from
  		ez_user u join authority a
  			on u.user_id = a.user_id
  	where
  		u.yellowcard >= 3
  </select>
  
  <select id="findAllNotBlackList" resultMap="userMap">
  	select
  		u.*,
  		a.user_id auth_user_id,
  		a.auth
  	from
  		ez_user u join authority a
  			on u.user_id = a.user_id
  	where
  		<![CDATA[
  			u.yellowcard < 3
  		]]>
  </select>
  
  <resultMap type="user" id="userMap">
  	<id column="user_id" property="userId"/>
  	<result column="user_name" property="userName"/>
  	<result column="phone" property="phone"/>
  	<result column="password" property="password"/>
  	<result column="email" property="email"/>
  	<result column="gender" property="gender"/>
  	<result column="yellowcard" property="yellowCard"/>
  	<result column="point" property="point"/>
  	<result column="enabled" property="enabled"/>
  	<result column="enroll_date" property="enrollDate"/>
  	<result column="enroll_type" property="enrollType"/>

  	
  	<collection property="authorityList" ofType="authority">
  		<id column="auth_user_id" property="userId"/>
  		<id column="auth" property="auth"/>
  	</collection>
  </resultMap>
  
  <select id="findCampZoneByZoneCode" resultMap="zoneMap">
  	select
	    z.*,
	    p.zone_photo_no,
	    p.zone_code zone_photo_zone_code,
	    p.original_filename,
	    p.renamed_filename
	from
	    camp_zone z left join camp_photo p 
	        on z.zone_code = p.zone_code
	where
	    z.zone_code = #{zoneCode}
  </select>
  
  <resultMap type="campZone" id="zoneMap">
  	<id column="zone_code" property="zoneCode"/>
  	<result column="zone_name" property="zoneName"/>
  	<result column="zone_info" property="zoneInfo"/>
  	<result column="zone_maximum" property="zoneMaximum"/>
  	<result column="zone_price" property="zonePrice"/>
  	
  	<collection property="campPhotos" ofType="campPhoto">
   		<id column="zone_photo_no" property="zonePhotoNo"/>
  		<result column="zone_photo_zone_code" property="zoneCode"/>
  		<result column="original_filename" property="originalFilename"/>
  		<result column="renamed_filename" property="renamedFilename"/>
  	</collection>
  </resultMap>
  
  <select id="findAllAssignmentList" resultMap="assignmentMap"> 
	select  
	    *
	from
	    assignment a left join reservation r
	        on a.res_no = r.res_no
	where
	    res_checkin > current_date
	order by
	    res_checkin
  </select>
  
  <select id="findAssignmentListBySelectType" resultMap="assignmentMap">
	select  
	    *
	from
	    assignment a left join reservation r
	        on a.res_no = r.res_no
	where
	    res_checkin > current_date
	    and
	    assign_state = #{selectType}
	order by
	    res_checkin  
  </select>
  
  <select id="findAllExpireAssignmentList" resultMap="assignmentMap">
	select  
	    *
	from
	    assignment a left join reservation r
	        on a.res_no = r.res_no
	where
	    <![CDATA[
	    	res_checkin <= current_date
	    ]]>
	order by
	    res_checkin  	
  </select>
  
  <resultMap type="assignment" id="assignmentMap">
   	<id column="assign_no" property="assignNo"/>
  	<result column="user_id" property="userId"/>
  	<result column="res_no" property="resNo"/>
  	<result column="assign_title" property="assignTitle"/>
  	<result column="assign_content" property="assignContent"/>
  	<result column="assign_price" property="assignPrice"/>
  	<result column="assign_date" property="assignDate"/>
  	<result column="assign_like_count" property="assignLikeCount"/>
  	<result column="assign_state" property="assignState"/>
  	<result column="assign_transfer" property="assignTransfer"/>
  	<association property="reservation" javaType="reservation">
  		<result column="camp_id" property="campId"/>
  		<result column="res_price" property="resPrice"/>
  		<result column="res_checkin" property="resCheckin"/>
  		<result column="res_checkout" property="resCheckout"/>
  	</association>	
  </resultMap>
</mapper>